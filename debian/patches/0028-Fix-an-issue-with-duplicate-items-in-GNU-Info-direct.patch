From: =?utf-8?q?Ulrich_M=C3=BCller?= <ulm@gentoo.org>
Date: Wed, 2 Feb 2011 17:27:00 +0000
Subject: Fix an issue with duplicate items in GNU Info directory

Bug: https://debbugs.gnu.org/cgi/bugreport.cgi?bug=7942
Origin: https://gitweb.gentoo.org/proj/emacs-patches.git/commit/?id=5de8096fcb2801c50e9c279ae41e046dcd70be44
---
 Makefile.in | 31 +++++++++++++------------------
 1 file changed, 13 insertions(+), 18 deletions(-)

diff --git a/Makefile.in b/Makefile.in
index 29e1a1a..1f589a7 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -494,29 +494,24 @@ install-arch-indep: mkdir info
 	thisdir=`/bin/pwd`; \
 	if [ `(cd ${srcdir}/info && /bin/pwd)` != `(cd $(DESTDIR)${infodir} && /bin/pwd)` ]; \
 	then \
-	  (cd $(DESTDIR)${infodir};  \
-	   if [ -f dir ]; then true; \
-	   else	\
-	     (cd $${thisdir}; \
-	      ${INSTALL_DATA} ${srcdir}/info/dir $(DESTDIR)${infodir}/dir; \
-	      chmod a+r $(DESTDIR)${infodir}/dir); \
-	   fi; \
-	   cd ${srcdir}/info ; \
+	  (cd ${srcdir}/info ; \
 	   for elt in $(INFO_FILES); do \
 	      for f in `ls $$elt $$elt-[1-9] $$elt-[1-9][0-9] 2>/dev/null`; do \
 	        ${INSTALL_DATA} $$f $(DESTDIR)${infodir}/$$f; \
 	        chmod a+r $(DESTDIR)${infodir}/$$f; \
 	      done; \
-	   done); \
-	else true; fi
-	-unset CDPATH; \
-	thisdir=`/bin/pwd`; \
-	if [ `(cd ${srcdir}/info && /bin/pwd)` != `(cd $(DESTDIR)${infodir} && /bin/pwd)` ]; \
-	then \
-	  for elt in $(INFO_FILES); do \
-	    (cd $${thisdir}; \
-	     ${INSTALL_INFO} --info-dir=$(DESTDIR)${infodir} $(DESTDIR)${infodir}/$$elt); \
-	  done; \
+	   done; \
+	   cd $(DESTDIR)${infodir};  \
+	   if [ -f dir ]; then \
+	      for elt in $(INFO_FILES); do \
+		 (cd $${thisdir}; \
+		  ${INSTALL_INFO} --info-dir=$(DESTDIR)${infodir} $(DESTDIR)${infodir}/$$elt); \
+	      done; \
+	   else	\
+	     (cd $${thisdir}; \
+	      ${INSTALL_DATA} ${srcdir}/info/dir $(DESTDIR)${infodir}/dir; \
+	      chmod a+r $(DESTDIR)${infodir}/dir); \
+	   fi); \
 	else true; fi
 	-chmod -R a+r $(DESTDIR)${datadir}/emacs/${version} $(DESTDIR)${datadir}/emacs/site-lisp ${COPYDESTS} $(DESTDIR)${infodir}
 	thisdir=`/bin/pwd`; \
